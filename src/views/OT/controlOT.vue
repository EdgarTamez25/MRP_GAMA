<template>
	<v-container>
		<v-row justify="center">
			<v-col cols="12" >
				
				<v-snackbar v-model="alerta.activo" multi-line vertical top right :color="alerta.color" > 
          <strong> {{alerta.texto}} </strong>
          <template v-slot:action="{ attrs }">
            <v-btn color="white" text @click="alerta.activo = false" v-bind="attrs"> Cerrar </v-btn>
          </template>
        </v-snackbar>
        
				<v-card-actions class="pa-0" >
					<v-card-text class="font-weight-black text-h6">  
          {{ modoVista === 1? 'NUEVA ORDEN DE TRABJO':'DETALLE ORDEN DE TRABAJO' }} 
          </v-card-text> 
					<v-spacer></v-spacer>
					<v-btn color="error" fab small @click="$emit('modal',false)" ><v-icon>clear</v-icon></v-btn>
				</v-card-actions>

				<v-row>
        <!-- VISTA EN MODO EDITAR -->
          <!-- RESUMEN DE LA ORDEN DE TRABAJO  -->
          <v-col cols="12" sm="8" v-if="modoVista === 2">
            <v-card outlined>
              <v-simple-table dense >
                <template v-slot:default>
                  <tbody >
                    <tr >
                      <td class="font-weight-black">CLIENTE</td>
                      <td class="subtitle-1"  align="left"> {{ parametros.nomcli }}</td>
                    </tr>
                    <tr>
                      <td class="font-weight-black">RESPONSABLE</td>
                      <td class="subtitle-1">{{ parametros.solicitante }}</td>
                    </tr>
                    <tr>
                      <td class="font-weight-black">SOLICITUD</td>
                      <td class="subtitle-1" v-if="parametros.id_solicitud"> {{ parametros.id_solicitud }} </td>
                      <td class="subtitle-1" v-else> S/REFERENCIA</td>

                    </tr>
                    <tr>
                      <td class="font-weight-black">CREACIÓN</td>
                      <td class="subtitle-1">  {{  moment(parametros.fecha + ' '  + parametros.hora).format('llll') }} </td>
                    </tr>
                  </tbody>
                </template>
              </v-simple-table>
            </v-card>
          </v-col>
          
          <!-- CAMPO DE ORDEN DE COMPRA  -->
          <v-col cols="12" sm="4" v-if="modoVista === 2">
            <v-text-field
              v-model="orden_compra" label="Orden de compra" hide-details dense filled clearable 
            ></v-text-field>
            <v-btn 
                v-if="modoVista===2 && parametros.estatus != 3 " 
                :disabled="orden_compra? false:true" 
                @click="PrepararPeticion()"
                color="rosa" 
                dark 
                block
                class="mt-2"
            >  Actualizar OC 
            </v-btn>
          </v-col>

          <v-col cols="12" class="py-0 pa-0">
            <v-card-text class="font-weight-black text-h6 py-0 text-center" > 
          
              PRODUCTOS A SOLICITAR 
            </v-card-text>
          </v-col>

          <v-col cols="12" class="mt-12" v-if="!detalle.length && modoVista != 1">
            <loading  />
          </v-col>
          <!-- TABLA DE PRODUCTOS POR SOLICITAR -->
          <v-col cols="12" v-else>
            <v-card outlined >
              <v-simple-table fixed-header height="auto" >
                <template v-slot:default>
                  <thead>
                    <tr>
                      <th class="text-left"> Producto  </th>
                      <th class="text-left"> Cantidad  </th>
                      <th class="text-left"> Unidad  </th>
                      <th class="text-left"> Concepto  </th>
                      <th class="text-left"> Fecha entrega  </th>
                      <th class="text-left"> Urgencia  </th>
                      <th class="text-left"> Estatus</th>
                      <th class="text-left" v-if="parametros.estatus === 1"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="(item, i) in detalle" :key="i">
                      <td>{{ item.producto }}</td>
                      <td>{{ item.cantidad | currency(0) }}</td>
                      <td>{{ item.unidad }}</td>
                      <td>
                        <span v-if="item.concepto === 1"> PRODUCCION </span>
                        <span v-if="item.concepto === 2"> STOCK </span>
                      </td>
                      <td> {{  moment(item.fecha_entrega).format('LL')  }} </td>
                      
                      <td>
                        <span v-if="item.urgencia === 1"> NORMAL</span>
                        <span v-if="item.urgencia === 2"> URGENTE</span>
                        <span v-if="item.urgencia === 3"> PRIORIDAD</span>
                      </td>
                      <td>
                        <span class="error--text font-weight-black" v-if="item.estatus === 1"> PENDIENTE</span>
                        <span class="orange--text font-weight-black" v-if="item.estatus === 2"> PROGRAMADA</span>
                        <span class="success--text font-weight-black" v-if="item.estatus === 3"> FINALIZADA</span>
                      </td>
                      <td v-if="item.estatus === 1" >
                        <v-btn 
                          color="success" 
                          class="ma-1" icon 
                          v-if="parametros.estatus === 1 && item.concepto != 1" 
                          @click="rellenaCampos(item)"
                        > 
                        
                          <v-icon>mdi-pencil</v-icon> 
                        </v-btn>

                        <v-btn 
                          color="error" 
                          class="ma-1" icon 
                          v-if="parametros.estatus === 1 && item.concepto != 1"
                          @click="eliminaPartida(item.id)"
                        > 
                          <v-icon>mdi-delete</v-icon> 
                        </v-btn>

                      </td>
                    </tr>
                  </tbody>
                </template>
              </v-simple-table>
            </v-card>
          </v-col>
          
				</v-row>
        
        <v-col cols="12" class="mt-3"/>
        
        <!-- //!CONTENEDOR DE CIERRE Y PROCESOS -->
        <v-footer  absolute v-if="modoVista === 1">
          <v-spacer></v-spacer>
          <v-btn color="success" small v-if="modoVista===1" @click="validaInformacion()" >  Guardar información </v-btn>
          <v-btn color="success" small v-if="modoVista===2" @click="validaInformacion()" >  Actualizar información </v-btn>
        </v-footer>

        <!-- FORMULARIO EDICION-->
        <v-dialog v-model="FormularioProductos" width="600px">
          <v-snackbar v-model="alerta.activo" multi-line vertical top right :color="alerta.color" > 
            <strong> {{alerta.texto}} </strong>
            <template v-slot:action="{ attrs }">
              <v-btn color="white" text @click="alerta.activo = false" v-bind="attrs"> Cerrar </v-btn>
            </template>
          </v-snackbar>

          <v-card class="pa-4">
            <v-row>
              <v-col cols="12" class="py-0 pa-0">
                <v-card-actions>
                  <v-card-text class="font-weight-black text-h6 text-left"> PRODUCTO: 
                    <span class="rosa--text">  {{ producto.nombre }} </span>
                  </v-card-text>
                  <v-spacer></v-spacer>
                  <v-btn color="error" small  @click="limpiarCamposPartida()" ><v-icon>clear</v-icon></v-btn>
                </v-card-actions>
              </v-col>

              <v-col cols="12" sm="6">
                <v-text-field
                  v-model="cantidad" label="Cantidad" hide-details dense filled clearable type="number"
                ></v-text-field>
                <span class="font-weight-black mx-3" v-if="cantidad"> 
                  {{ cantidad | currency(0) }}  
                </span>
              </v-col>

              <v-col cols="12" sm="6"  >
                <v-text-field
                  v-model="fecha1" label="Fecha entrega" 
                  dense hide-details color="celeste" filled type="date"
                ></v-text-field>
              </v-col> 
              <!--
              <v-col cols="12" sm="6">
                <v-select
                  v-model="concepto" :items="conceptos" item-text="nombre" item-value="id" color="celeste" 
                  dense hide-details  label="Conceptos" return-object filled
                ></v-select> 
              </v-col>
              -->
              <v-col cols="12" sm="6">
                <v-select
                  v-model="urgencia" :items="urgencias" item-text="nombre" item-value="id" filled color="celeste" 
                  dense hide-details  label="Urgencia" return-object 
                ></v-select> 
              </v-col>

              <v-col cols="12" sm="6" v-if="concepto.id === 1"> 
                <v-textarea
                  v-model ="razon" filled label="Razon de la urgencia" rows="1" 
                  hide-details dense :disabled="urgencia.id != 1 && urgencia.id ? false:true"
                ></v-textarea>
              </v-col>

              <v-col cols="12" sm="6" class="py-0 text-right" v-if="modo === 1"> 
                <v-btn color="celeste" dark  @click="validarPartida(1) "> Agregar partida</v-btn> 
              </v-col>

              <v-col cols="12">
                <v-textarea
                  v-model="comentarios" label="Comentarios" 
                  dense hide-details color="celeste" filled rows="2"
                ></v-textarea>
              </v-col> 

              <v-col cols="12" sm="6">
                <v-select
                  v-model="moneda" :items="monedas" item-text="nombre" item-value="id" filled 
                  dense hide-details label="Moneda" return-object 
                ></v-select>
              </v-col>

              <!-- //! PRECIO  -->
              <v-col cols="12" sm="6" >
                <v-text-field 
                  v-model="precio" hide-details dense label="Precio" type="number"
                  filled placeholder="Precio"
                />
              </v-col>

              
            </v-row>
            <div class="mt-12"></div>
            <v-footer absolute fixed>
              <v-spacer></v-spacer>
              <v-btn dark color="success"  @click="validarPartida(2)" >
                Actualizar
              </v-btn> 
            </v-footer>
          </v-card>
        </v-dialog>

        <v-dialog v-model="Correcto" hide-overlay persistent width="350">
          <v-card :color="colorCorrecto" dark class="pa-3">
            <v-card-text class="font-weight-black headline pa-3 white--text" align="center">
              {{ textCorrecto }}
            </v-card-text>
          </v-card>
        </v-dialog>

        <v-dialog v-model="alertaEliminar"  persistent width="400">
          <v-card>
            <v-card-title class="subtitle-1 font-weight-black " style="word-break:normal;">¿ESTÁS SEGURO DE QUERER ELIMINAR LA PARTIDA ? </v-card-title>
            <v-divider class="my-0 py-3" ></v-divider>
            <v-card-subtitle align="center" class="red--text font-weight-bold "> LA INFORMACIÓN SE PERDERÁ COMPLETAMENTE </v-card-subtitle>
            <v-divider class="my-0 py-2 " ></v-divider>
            <v-card-actions>
              <v-btn color="gris"    dark   @click="alertaEliminar=false" >  NO, Cancelar </v-btn>
              <v-spacer/>
              <v-btn color="celeste" text   @click="editarEliminarPartida()" >  SÍ, Eliminar </v-btn>
            </v-card-actions>
          </v-card>
        </v-dialog>
          
        <overlay v-if="overlay"/>

			</v-col>
		</v-row>
	</v-container>
	
</template>

<script>
  import Vue from 'vue'
  import {mapGetters, mapActions} from 'vuex'
  import  metodos from '@/mixins/metodos.js';
  import overlay     from '@/components/overlay.vue';
  import loading     from '@/components/loading.vue';

  var accounting = require("accounting");
  Vue.filter('currency', (val, dec) => { return accounting.formatMoney(val, '', dec) });

	export default {
		mixins:[metodos],
		// mixins:[metodos,jsPdf],
	  components: {
      overlay,
      loading
		},
		props:[
			'modoVista',
			'parametros',
	  ],
	  data () {
			return {
        componente:'OT',
        // VARIABLES PRINCIPALES
        idEditar: null,
        idAEliminar: null,
        alertaEliminar: false,
        FormularioProductos: false,

        orden_compra:'',
        id_solicitud:null,
        cantidad: '',
        razon:'',
        detalle: [],
        modo: 1,
				// FECHA
        fecha1: new Date().toISOString().substr(0, 10),
        fechamodal1:false,

        deptos: [],
        depto: { id: null, nombre:''},
        concepto: { id: null, nombre:''},
        conceptos: [{id:1, nombre:'PRODUCCION'}, {id:2, nombre:'STOCK'}],

        urgencias:[{id:1, nombre:'NORMAL'},{id:2, nombre:'URGENTE'},{ id:3, nombre:'PRIORIDAD'}],
        urgencia: { id:null, nombre:''},
				// AUTOCOMPLETE
				usuarios : [],
				usuario	 : {id:null, nombre:''},
				clientes	: [],
				cliente		: {id:null, nombre:''},
				// SELECTORES
				producto : { id:null, nombre:''},
				productos: [],

        comentarios: '',
        monedas  : [{ id:1, nombre:'MXN'},{ id:2, nombre:'USD'}],
        moneda   : { id:1, nombre:'MXN'},
        precio   : 0,
				// ALERTAS
				alerta: { activo: false, texto:'', color:'error'},

        overlay     : false,
				textDialog  :'',
				Correcto    : false,
        textCorrecto: '',
        colorCorrecto: 'success',
			}
		},
		
		created(){
      // this.consultar_Usuarios();
      // this.consultar_Clientes();
      // this.consultaDepartamentos();
			this.validarModoVista(); 	  // VALIDO EL MODO DE LA VISTA
		},
			
		computed:{
			// IMPORTANDO USO DE VUEX - PRODUCTOS (GETTERS)
      ...mapGetters('Login'    ,['getdatosUsuario']), 
      ...mapGetters('ProductosxCliente' ,['Loading','getPxCxD']), // IMPORTANDO USO DE VUEX - PRODUCTOS (GETTERS)
			...mapGetters('OT',['Parametros']), // IMPORTANDO USO DE VUEX - (GETTERS)
      ...mapGetters('TipoCambio' ,['tipo_cambio_hoy']), 

		},

		watch:{ 
      modoVista(){
        this.validarModoVista();
      },
      parametros(){ 
        this.validarModoVista(); 	
      } ,
    },

		methods:{
			// IMPORTANDO USO DE VUEX - PRODUCTOS(ACCIONES)
				...mapActions('ProductosxCliente',['consultaPxCxD']), // IMPORTANDO USO DE VUEX - PRODUCTOS(ACCIONES)
			  ...mapActions('OT'  ,['consultaOT','guardaParametrosConsulta']), // IMPORTANDO USO DE VUEX - CLIENTES(ACCIONES)
    
      validarPartida(modo){
        this.modo = modo;
        if(!this.cantidad)		{ this.alerta = { activo: true, texto:'DEBES ESPECIFICAR UNA CANTIDAD', color:'error'}; return }
        if(!this.concepto.id) { this.alerta = { activo: true, texto:'DEBES SELECCIONAR UN CONCEPTO' , color:'error'}; return }
        if(!this.urgencia.id) { this.alerta = { activo: true, texto:'DEBES SELECCIONAR LA URGENCIA DE LA O.T.' , color:'error'}; return }
        if(!this.moneda.id)   { this.alerta = { activo: true, texto:'DEBES SELECCIONAR LA MONEDA.' , color:'error'}; return }
        if(!this.precio)      { this.alerta = { activo: true, texto:'DEBES AÑADIR EL PRECIO DEL PRODUCTO.' , color:'error'}; return }
        // if(this.urgencia.id != 1 && !this.razon) { 
        //     this.alerta = { activo: true, texto:'TIENES QUE ESCRIBIR LA RAZON DE LA URGENCIA.' , color:'error'}; return;
        // }

        this.modo === 1 ? this.agregarPartida(): this.editaPartida();
      },

      agregarPartida(){
        const partida = new Object();
              partida.id            = this.detalle.length + 1 ;
              partida.id_ot         = this.modoVista === 2 ? this.parametros.id: '';
              partida.id_producto   = this.producto.id;
              partida.producto      = this.producto.nombre;
              partida.cantidad      = this.cantidad;
              partida.concepto      = this.concepto.id;
              partida.fecha_progra  = this.traerFechaActual();
              partida.fecha_entrega = this.fecha1;
              partida.urgencia      = this.urgencia.id;
              partida.razon         = this.razon? this.razon:'';
        
        if(this.modoVista === 1){
          this.detalle.push(partida);
          this.limpiarCamposPartida();
          this.alerta = { activo: true, texto:'LA PARTIDA SE AGREGO CORRECTAMENTE' , color:'success'}; 
        }

        if(this.modoVista === 2 ){
          this.$http.post('agregar.partida.detot', partida).then(response =>{
            this.consultaDetalle(this.parametros.id)
            this.limpiarCamposPartida();
            this.alerta = { activo: true, texto:response.bodyText , color:'success'}; 
          }).catch(error =>{ console.log('error', error)})
        }

      },

      rellenaCampos(item){
        this.FormularioProductos = true;
        this.idEditar = item.id;
        this.cantidad = item.cantidad;
        this.concepto = { id: item.concepto };
        this.depto    = { id: item.id_depto };
        this.fecha1   = item.fecha_entrega;
        this.urgencia = { id: item.urgencia };
        this.razon    = item.razon;
        this.producto = { id: item.id_producto, nombre: item.producto };
        this.comentarios = item.comentarios;
        this.moneda = { id: item.id_moneda };
        this.precio = item.id_moneda == 1 ? item.MXN : item.USD; 
        this.modo = 2;
      },

      editaPartida(){
        if (!this.tipo_cambio_hoy) {
          this.alerta = { activo: true, texto:'Aun no asignas el tipo de cambio.', color:'error'};
          return;
        }

        let precio_peso = 0 , precio_dolar = 0;
        
        if(this.tipo_cambio_hoy.cambio){ 
          
          if(this.moneda.id  == 1){
            // TRANSFORMAR A DOLARES.
            precio_dolar = (this.precio / this.tipo_cambio_hoy.cambio).toFixed(2);
            precio_peso = this.precio;
          }

          if(this.moneda.id  == 2){
            // TRANSFORMAR A PESO.
            precio_dolar = this.precio ;
            precio_peso = this.precio * this.tipo_cambio_hoy.cambio;
          }

        }else{
          // this.overlay = false;
          this.alerta = { activo: true, texto: "No se ha registrado el tipo de cambio hoy."};
          return;
        }

        if(this.modoVista === 1 ){
            this.detalle = this.detalle.map( item => { 
            if(item.id === this.idEditar){
              item.id_producto   = this.producto.id;
              item.producto      = this.producto.nombre;
              item.cantidad      = this.cantidad;
              item.concepto      = this.concepto.id
              item.fecha_entrega = this.fecha1;
              item.urgencia      = this.urgencia.id;
              item.razon         = this.razon? this.razon:'';
            }
            return item;
          })
        }

        // ! POR EL MOMENTO SOLO ESTE SE USA 
        if(this.modoVista === 2){
          const payload = { 
            id          : this.idEditar,
            id_producto : this.producto.id,
            cantidad    : this.cantidad,
            concepto    : this.concepto.id,
            fecha_entrega : this.fecha1, 
            urgencia    : this.urgencia.id,
            razon       : this.razon? this.razon:'',
            tipo_cambio : this.tipo_cambio_hoy.cambio,
            comentarios : this.comentarios,
            id_moneda   : this.moneda.id,
            MXN         : precio_peso,
            USD         : precio_dolar
          }
          
          this.$http.post('actualiza.partida.detot',payload).then(response =>{
            this.consultaDetalle(this.parametros.id)
            this.alerta = { activo: true, texto:response.bodyText , color:'success'}; 
            this.limpiarCamposPartida();
            this.modo = 1 ;
          }).catch(error =>{ 
            this.alerta = { activo: true, texto:error.bodyText , color:'error'}; 
            console.log('error', error)
          })
        }
        
        
      },

      limpiarCamposPartida(){
        this.FormularioProductos = false; 
        this.producto = { id:null, nombre:'' };
        this.cantidad = '';
        this.concepto = { id:null, nombre:'' };
        this.fecha    = new Date().toISOString().substr(0, 10);
        this.urgencia = { id:null, nombre:''};
        this.razon    = '';
        this.comentarios = '', 
        this.moneda = { id: null, nombre:''};
        this.precio = 0;
        this.modo     = 1;

      },

      eliminaPartida(id){
        if(this.modoVista === 1){
          this.detalle = this.detalle.filter( item => { if(item.id != id){ return item; }; });  
          this.alerta = { activo: true, texto:'LA PARTIDA SE ELIMINO CORRECTAMENTE' , color:'success'}; 
        }

        if(this.modoVista === 2){
          // console.log('')
          if(this.detalle.length <= 1){
            this.alerta = { activo: true, texto:'Debe haber al menos 1 producto en la lista.' , color:'error'}; 
            return;
          }
          this.idAEliminar = id;
          this.alertaEliminar = true; 
        }
        
      },

      editarEliminarPartida(){
        this.$http.delete('elimina.partida.detot/'+ this.idAEliminar).then( response =>{
          this.consultaDetalle(this.parametros.id)
          this.alertaEliminar = false;
          this.alerta = { activo: true, texto:response.bodyText , color:'success'}; 
        }).catch( error => { console.log('error', error)})
      },

			validarModoVista(){
				if(this.modoVista === 2){
          this.FormularioProductos = false;
          // ASIGNAR VALORES AL FORMULARIO
          this.usuario      = { id: this.parametros.id_solicitante , nombre: this.parametros.solicitante }
					this.cliente      = { id: this.parametros.id_cliente  , nombre: this.nomcli}
          this.orden_compra = this.parametros.oc;
          this.id_solicitud   = this.parametros.id_solicitud;
          this.consultaDetalle(this.parametros.id);
				}else{
				  this.limpiarCampos()
				}
      },
      
      consultaDetalle(id){
        this.$http.get('detalle.ot/'+ id).then((response)=>{
          this.detalle = response.body
        }).catch( error =>{ console.log('error', error) })
      },

			validaInformacion(){
				if(!this.depto.id)	 	    { this.alerta = { activo: true, texto:'DEBES AGREGAR EL DEPARTAMENTO'           , color:'error'}; return }
				if(!this.usuario.id)		  { this.alerta = { activo: true, texto:'DEBES AGREGAR EL RESPONSABLE DEL PEDIDO'          , color:'error' }; return }
				if(!this.cliente.id)	    { this.alerta = { activo: true, texto:"DEBES AGREGAR EL CLIENTE QUE SOLICITA EL PRODUCTO", color:'error' }; return }
				if(!this.detalle.length)	{ this.alerta = { activo: true, texto:"DEBES AGREGAR AL MENOS 1 PRODUCTO"                , color:'error' }; return }
				this.PrepararPeticion()
			},

			async PrepararPeticion(){
        let permiso = await this.verificar_permiso_usuario(this.componente);
        this.overlay = true;  // ACTIVO OVERLAY DE GUARDADO

        if(!permiso){
          this.overlay = false
          this.alerta = { 
            activo: true,
            texto : `Lo sentimos, no tienes permiso de modificar información relacionada con ${ this.componente }`,
            color : 'error'
          };
          return;
        }

        // FORMAR ARRAY A MANDAR
        const payload = new Object();
              // payload.id_depto     = this.depto.id,
              payload.id_sucursal  = this.getdatosUsuario.id_sucursal,
              payload.id_usuario   = this.usuario.id,
              payload.id_cliente   = this.cliente.id,
              payload.oc			     = this.orden_compra? this.orden_compra: 'SIN O.C.',
              payload.referencia   = this.referencia ? this.referencia : 'SIN REFERENCIA',
              payload.fecha        = this.traerFechaActual(),
              payload.hora			   = this.traerHoraActual(),
              payload.creacion     = this.traerFechaActual() + ' '+ this.traerHoraActual(),
              payload.id_creador   = this.getdatosUsuario.id,
              payload.detalle      = this.detalle

				// VALIDO QUE ACCION VOY A EJECUTAR SEGUN EL MODO DE LA VISTA
				this.modoVista === 1 ? this.Crear(payload): this.Actualizar(payload);
			},




			Crear(payload){
				this.$http.post('crear.orden.trabajo', payload).then((response)=>{
          // console.log('response', response)
					this.TerminarProceso(response.bodyText);					
				}).catch(error =>{
					this.mostrarError(error.bodyText)
				}).finally(() => this.overlay = false) 
			},

			Actualizar(payload){
				this.$http.put('actualiza.ot/'+ this.parametros.id, payload).then((response)=>{
          this.alerta = { activo: true, texto: response.bodyText, color:'green' }
				  // this.consultaOT(this.Parametros) //ACTUALIZAR CONSULTA DE CLIENTES
				}).catch(error =>{
          this.alerta = { activo: true, texto: error.bodyText, color:'error' }
				}).finally(() => this.overlay = false)
			},
	
			TerminarProceso(mensaje){
				var that = this ;
        this.Correcto = true ; this.textCorrecto = mensaje;
				this.consultaOT(this.Parametros) //ACTUALIZAR CONSULTA DE CLIENTES
        setTimeout(function(){ that.$emit('modal',false)}, 2000);
				setTimeout(function(){ that.limpiarCampos()}, 2000);
			},

			limpiarCampos(){
        // this.FormularioProductos = true;
        this.producto = { id:null, nombre:'' };
        this.cantidad = '';
        this.concepto = { id:null, nombre:'' };
        this.fecha    = new Date().toISOString().substr(0, 10);
        this.urgencia = { id:null, nombre:''};
        this.razon    = '';
        this.modo     = 1;
        this.usuario = { id: null, nombre:''};
        // this.depto    = { id: null, nombre:''};
        this.cliente  = { id: null, nombre:''};
        this.orden_compra = '';
        this.referencia   = '';
        this.detalle      = [];
			},

			mostrarError(mensaje){
				this.snackbar=true; this.text=mensaje; this.color = "error";
      },
      
		}
	}
</script>